\hypertarget{a00146_source}{}\section{glibc-\/sched.h}
\label{a00146_source}\index{glibc-\/sched.\+h@{glibc-\/sched.\+h}}

\begin{DoxyCode}
00001 \textcolor{comment}{/*}
00002 \textcolor{comment}{ * Copyright © 2009 CNRS}
00003 \textcolor{comment}{ * Copyright © 2009-2020 Inria.  All rights reserved.}
00004 \textcolor{comment}{ * Copyright © 2009-2011 Université Bordeaux}
00005 \textcolor{comment}{ * Copyright © 2011 Cisco Systems, Inc.  All rights reserved.}
00006 \textcolor{comment}{ * See COPYING in top-level directory.}
00007 \textcolor{comment}{ */}
00008 
00017 \textcolor{preprocessor}{#ifndef HWLOC\_GLIBC\_SCHED\_H}
00018 \textcolor{preprocessor}{#define HWLOC\_GLIBC\_SCHED\_H}
00019 
00020 \textcolor{preprocessor}{#include "hwloc.h"}
00021 \textcolor{preprocessor}{#include "hwloc/helper.h"}
00022 
00023 \textcolor{preprocessor}{#include <assert.h>}
00024 
00025 \textcolor{preprocessor}{#if !defined \_GNU\_SOURCE || (!defined \_SCHED\_H && !defined \_SCHED\_H\_) || (!defined CPU\_SETSIZE && !defined
       sched\_priority)}
00026 \textcolor{preprocessor}{#error Please make sure to include sched.h before including glibc-sched.h, and define \_GNU\_SOURCE before
       any inclusion of sched.h}
00027 \textcolor{preprocessor}{#endif}
00028 
00029 
00030 \textcolor{preprocessor}{#ifdef \_\_cplusplus}
00031 \textcolor{keyword}{extern} \textcolor{stringliteral}{"C"} \{
00032 \textcolor{preprocessor}{#endif}
00033 
00034 
00035 \textcolor{preprocessor}{#ifdef HWLOC\_HAVE\_CPU\_SET}
00036 
00037 
00056 \textcolor{keyword}{static} \_\_hwloc\_inline \textcolor{keywordtype}{int}
\Hypertarget{a00146_source_l00057}\hyperlink{a00217_ga88699a0c86c66a9b7baa3468cd9d24c3}{00057} \hyperlink{a00217_ga88699a0c86c66a9b7baa3468cd9d24c3}{hwloc\_cpuset\_to\_glibc\_sched\_affinity}(
      \hyperlink{a00186_ga9d1e76ee15a7dee158b786c30b6a6e38}{hwloc\_topology\_t} topology \_\_hwloc\_attribute\_unused, 
      \hyperlink{a00183_ga1f784433e9b606261f62d1134f6a3b25}{hwloc\_const\_cpuset\_t} hwlocset,
00058                                     cpu\_set\_t *schedset, \textcolor{keywordtype}{size\_t} schedsetsize)
00059 \{
00060 \textcolor{preprocessor}{#ifdef CPU\_ZERO\_S}
00061   \textcolor{keywordtype}{unsigned} cpu;
00062   CPU\_ZERO\_S(schedsetsize, schedset);
00063   \hyperlink{a00205_ga3f6861045a8029ade373510ffa727d2a}{hwloc\_bitmap\_foreach\_begin}(cpu, hwlocset)
00064     CPU\_SET\_S(cpu, schedsetsize, schedset);
00065   \hyperlink{a00205_gafcf3246db406218d4e155735b3fa6528}{hwloc\_bitmap\_foreach\_end}();
00066 \textcolor{preprocessor}{#else }\textcolor{comment}{/* !CPU\_ZERO\_S */}\textcolor{preprocessor}{}
00067   \textcolor{keywordtype}{unsigned} cpu;
00068   CPU\_ZERO(schedset);
00069   assert(schedsetsize == \textcolor{keyword}{sizeof}(cpu\_set\_t));
00070   \hyperlink{a00205_ga3f6861045a8029ade373510ffa727d2a}{hwloc\_bitmap\_foreach\_begin}(cpu, hwlocset)
00071     CPU\_SET(cpu, schedset);
00072   \hyperlink{a00205_gafcf3246db406218d4e155735b3fa6528}{hwloc\_bitmap\_foreach\_end}();
00073 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* !CPU\_ZERO\_S */}\textcolor{preprocessor}{}
00074   \textcolor{keywordflow}{return} 0;
00075 \}
00076 
00084 \textcolor{keyword}{static} \_\_hwloc\_inline \textcolor{keywordtype}{int}
\Hypertarget{a00146_source_l00085}\hyperlink{a00217_ga8ec807ec17de57fa77aa5cfd6c8e4bfb}{00085} \hyperlink{a00217_ga8ec807ec17de57fa77aa5cfd6c8e4bfb}{hwloc\_cpuset\_from\_glibc\_sched\_affinity}(
      \hyperlink{a00186_ga9d1e76ee15a7dee158b786c30b6a6e38}{hwloc\_topology\_t} topology \_\_hwloc\_attribute\_unused, 
      \hyperlink{a00183_ga4bbf39b68b6f568fb92739e7c0ea7801}{hwloc\_cpuset\_t} hwlocset,
00086                                        \textcolor{keyword}{const} cpu\_set\_t *schedset, \textcolor{keywordtype}{size\_t} schedsetsize)
00087 \{
00088   \textcolor{keywordtype}{int} cpu;
00089 \textcolor{preprocessor}{#ifdef CPU\_ZERO\_S}
00090   \textcolor{keywordtype}{int} count;
00091 \textcolor{preprocessor}{#endif}
00092   \hyperlink{a00205_gaa97c5217613c8cae9862287170ea2132}{hwloc\_bitmap\_zero}(hwlocset);
00093 \textcolor{preprocessor}{#ifdef CPU\_ZERO\_S}
00094   count = CPU\_COUNT\_S(schedsetsize, schedset);
00095   cpu = 0;
00096   \textcolor{keywordflow}{while} (count) \{
00097     \textcolor{keywordflow}{if} (CPU\_ISSET\_S(cpu, schedsetsize, schedset)) \{
00098       \hyperlink{a00205_ga062dbff93baeff3b425a7260c5463646}{hwloc\_bitmap\_set}(hwlocset, cpu);
00099       count--;
00100     \}
00101     cpu++;
00102   \}
00103 \textcolor{preprocessor}{#else }\textcolor{comment}{/* !CPU\_ZERO\_S */}\textcolor{preprocessor}{}
00104   \textcolor{comment}{/* sched.h does not support dynamic cpu\_set\_t (introduced in glibc 2.7),}
00105 \textcolor{comment}{   * assume we have a very old interface without CPU\_COUNT (added in 2.6)}
00106 \textcolor{comment}{   */}
00107   assert(schedsetsize == \textcolor{keyword}{sizeof}(cpu\_set\_t));
00108   \textcolor{keywordflow}{for}(cpu=0; cpu<CPU\_SETSIZE; cpu++)
00109     \textcolor{keywordflow}{if} (CPU\_ISSET(cpu, schedset))
00110       \hyperlink{a00205_ga062dbff93baeff3b425a7260c5463646}{hwloc\_bitmap\_set}(hwlocset, cpu);
00111 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* !CPU\_ZERO\_S */}\textcolor{preprocessor}{}
00112   \textcolor{keywordflow}{return} 0;
00113 \}
00114 
00118 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* CPU\_SET */}\textcolor{preprocessor}{}
00119 
00120 
00121 \textcolor{preprocessor}{#ifdef \_\_cplusplus}
00122 \} \textcolor{comment}{/* extern "C" */}
00123 \textcolor{preprocessor}{#endif}
00124 
00125 
00126 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* HWLOC\_GLIBC\_SCHED\_H */}\textcolor{preprocessor}{}
\end{DoxyCode}
